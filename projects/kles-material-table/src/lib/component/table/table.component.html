<form class="dynamic-form" [formGroup]="form">
  <ng-container *ngIf="virtualScroll; else tableTemplate">
    <cdk-virtual-scroll-viewport tvsItemSize autosize style="height: 100%" [tableComponent]="table">
      <ng-container *ngTemplateOutlet="tableTemplate">
      </ng-container>
    </cdk-virtual-scroll-viewport>
  </ng-container>

  <ng-template #tableTemplate>
    <table mat-table matSort [dataSource]="dataSource" [ngClass]="options.elevation | elevationPipe"
      formArrayName="rows" [trackBy]="trackById">
      <ng-container *ngFor="let column of columns;" [cdkColumnDef]="column.columnDef" [sticky]="column.sticky || false">

        <th mat-header-cell *matHeaderCellDef [klesResizeColumn]="column.resizable" class="{{column.class}}"
          [ngClass]="{'vertical-separator': options.verticalSeparator}">
          <div style="display: inline-flex;">
            <ng-container klesDynamicField [field]="column.headerCell" [group]="formHeader">
            </ng-container>
          </div>
        </th>
        <div>
          <!-- <td mat-cell *cdkCellDef="let row;let index = index;" klesCellStyle [row]="row" [column]="column" -->
          <td mat-cell *cdkCellDef="let row;let index = index;" [style]="getCellStyle(row,column)"
            [ngClass]="{'vertical-separator': options.verticalSeparator}">
            <ng-container klesDynamicField [field]="column | fieldPipe:row.value._index" [group]="index | groupPipe"
              [siblingFields]="lineFields[index]">
            </ng-container>
          </td>


          <td mat-footer-cell *matFooterCellDef [style]="getFooterStyle(column)">
            <ng-container *ngIf="column.footerCell" klesDynamicField [field]="column.footerCell" [group]="formFooter">
            </ng-container>
          </td>
        </div>

      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true;"></tr>
      <tr mat-row [ngClass]="row | rowPipe" *matRowDef="let row; columns: displayedColumns;"></tr>
      <div *ngIf="showFooter">
        <tr mat-footer-row *matFooterRowDef="displayedColumns;sticky: true">
        </tr>
      </div>
    </table>
  </ng-template>

</form>

<div [hidden]="hidePaginator">
  <mat-paginator #paginator [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]="true"
    (page)="pageChanged($event)">
  </mat-paginator>
</div>