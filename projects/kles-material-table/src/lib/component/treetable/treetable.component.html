<form class="dynamic-form" [formGroup]="form" cdkScrollable>
    <table mat-table matSort [dataSource]="dataSource"
        [ngClass]="options.elevation | elevationPipe" formArrayName="rows" [trackBy]="trackById" cdkDropList
        (cdkDropListDropped)="drop($event)" [cdkDropListData]="this" [cdkDropListDisabled]="!dragDropRows"
        [cdkDropListAutoScrollStep]="dragDropRowsOptions.autoScrollStep" [cdkDropListSortPredicate]="sortPredicate()">
        <ng-container *ngFor="let column of columns;" [cdkColumnDef]="column.columnDef"
            [sticky]="column.sticky || false">

            <th mat-header-cell *matHeaderCellDef [klesResizeColumn]="column.resizable" class="{{column.class}}"
                [ngClass]="{'vertical-separator': options.verticalSeparator}">
                <div style="display: inline-flex;">
                    <ng-container klesDynamicField [field]="column.headerCell" [group]="formHeader">
                    </ng-container>
                </div>
            </th>

            <div *ngIf="column.visible">

                <ng-container *cdkCellDef="let row;let index = index;">
                    <td mat-cell [style]="getCellStyle(row,column)"
                        [ngClass]="{'vertical-separator': options.verticalSeparator}">

                        <ng-container klesDynamicCell [field]="column | fieldPipe:index" [group]="index | groupPipe"
                            [row]="row" [column]="column">
                        </ng-container>
                    </td>

                </ng-container>

                <td mat-footer-cell *matFooterCellDef [style]="getFooterStyle(column)">
                    <ng-container *ngIf="column.footerCell" klesDynamicField [field]="column.footerCell"
                        [group]="formFooter">
                    </ng-container>
                </td>

            </div>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true;"></tr>

        <tr mat-row [ngClass]="row | rowTreePipe" [@rowsAnimation]=""
            *matRowDef="let row; columns: displayedColumns; when: isParent;" (click)="onClick(row)" cdkDrag
            [cdkDragData]="row" [cdkDragDisabled]="(row | rowDragDisabledPipe)">


            <ng-template *ngIf="dragDropRowsOptions?.dragPreview?.component" cdkDragPreview [matchSize]="true">
                <ng-container klesComponent [component]="dragDropRowsOptions?.dragPreview?.component" [value]="row">
                </ng-container>
            </ng-template>

            <ng-template *ngIf="dragDropRowsOptions?.dragPlaceholder?.component" cdkDragPlaceholder>
                <ng-container klesComponent [component]="dragDropRowsOptions?.dragPlaceholder?.component" [value]="row">
                </ng-container>
            </ng-template>
        </tr>


        <tr mat-row [ngClass]="row | rowTreePipe" [@rowsAnimation]=""
            *matRowDef="let row; columns: displayedColumns; when: isChild;" (click)="onClick(row)" cdkDrag
            [cdkDragData]="row" [cdkDragDisabled]="(row | rowDragDisabledPipe)">

            <ng-template *ngIf="dragDropRowsOptions?.dragPreview?.component" cdkDragPreview [matchSize]="true">
                <ng-container klesComponent [component]="dragDropRowsOptions?.dragPreview?.component" [value]="row">
                </ng-container>
            </ng-template>

            <ng-template *ngIf="dragDropRowsOptions?.dragPlaceholder?.component" cdkDragPlaceholder>
                <ng-container klesComponent [component]="dragDropRowsOptions?.dragPlaceholder?.component" [value]="row">
                </ng-container>
            </ng-template>
        </tr>


        <div *ngIf="showFooter">
            <tr mat-footer-row *matFooterRowDef="displayedColumns;sticky: true">
            </tr>
        </div>
    </table>

</form>
<div [hidden]="hidePaginator">
    <mat-paginator #paginator [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]="true">
    </mat-paginator>
</div>